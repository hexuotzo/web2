{% extends "base.html" %}
{% load custom %}
        {% block extra_js %}
	<script type="text/javascript" src="/site_media/js/widgets.js"></script>
	<script type="text/javascript" src="/site_media/js/jquery.multiselect.js"></script>
	<script type="text/javascript" src="/site_media/js/jquery-ui-1.6.custom.min.js"></script>
	<script type="text/javascript" src="/site_media/js/swfobject.js"></script>
	<script type="text/javascript" src="/site_media/js/init.js"></script>
	<script type="text/javascript">
        function callback(data, status) {
	var table = $("#" + data["container"]);
	table.show().empty().append(data["content"]);
	table.next("div.resize").hide();
	table.parent("div.container").show();

	//set toolbar pics to default
	var toolbar = table.prev("div.nav").find("a");
	var table_icon = toolbar.filter("a.table");
	
	change_pic(toolbar);
	toolbar.attr("select", "");
	
	change_pic(table_icon, true);
	table_icon.attr("select", "true");
        }

	function obj2para(obj) {
	params = []
	for (var key in obj) {
	param  = key + "=" + encodeURIComponent(obj[key]);
	params.push(param);
	}
	params =  "?" + params.join("&");
	return encodeURIComponent(params);
	}

        function copy_form(form)
        {
        var obj = {};
        form.find(".time_query,.multi_query,.query_input").each(function(){if (this.value) {obj[this.name]=this.value;}});
        var container = form.parent("div").nextAll("div.container").find("div.table").attr("id");
        obj['container'] = container;
        var begin_date = form.find("select[name='begin_date']").val();
        var end_date = form.find("select[name='end_date']").val();
        if (begin_date && end_date) {
        obj['begin_date'] = begin_date;
        obj['end_date'] = end_date;
	}
	hidden_form = form.parent("div").nextAll("div.container").find("form");
	for (var key in obj) {
	hidden_form.find("input[name=" + key + "]").val(obj[key]);
        }

	obj["view_id"] = hidden_form.find("input[name=view_id]").val();
        return obj;
	}

	function collect_data(form) {
	var obj = {};
	$(form).find("input[type=hidden]").each(function(){
	if (this.value) {
	obj[this.name] = this.value;
	}
	});
	return obj;
	}

	function hide_els(container) {
	container = $(container);
	var table = container.children("div.table");
	table.hide();
	var resize = container.children("div.resize");
	resize.hide();
	resize.children().hide();
	}

	function change_pic(obj, active) {
	var reg = /(([1-6]+)).gif/;

	$(obj).each(function(){
	var url = $(this).css("background-image");

	if ((res = reg.exec(url)) != null) {
	if (active) {
	var rep = res[1].charAt(0);
	}
	else {
	var num = res[1].charAt(0);
	var rep = num + num;
	}
	}
	url = url.replace(reg, rep + ".gif");
	$(this).css("background-image", url);
	});
	}
	</script>
        {% endblock extra_js %}
	
	{% block extra_css %}
	<link rel="stylesheet" type="text/css" media="all" href="/site_media/css/aqua/theme.css" title="Aqua" />
	{% endblock extra_css %}
        
        {% block document_ready %}

        //initialize data submit
        $("input.submit_button").click(function(){
        //collect data
        var form = $(this).parents("form");
        var obj = copy_form(form);
        jQuery.get("{% url show_table %}", obj, callback, 'json');
        });
	
	$(".nav").find("a").mouseover(function(){
	if (!$(this).attr("select")) {change_pic(this, true);}
	}).mouseout(function(){if (!$(this).attr("select")) {change_pic(this);}});
	
	$(".nav").find("a").click(
	function(){
	change_pic($(this).parents("ul").find("a"));
	$(this).parents("ul").find("a").attr("select", "");

	change_pic(this, true);
	$(this).attr("select", "true");
	
	var container = $(this).parents("div.container");
	hide_els(container);
	
	var cls = $(this).attr("className");

	if (cls == "bar" || cls == "line"){
	var resize = container.children("div.resize");
	resize.show();

	var prefix = resize.attr("id").split("_")[0];
	var chart_id = [prefix, cls, "chart"].join("_");
	
	var obj = collect_data(container.find("form"));
	obj['type'] = cls
	var params = obj2para(obj);


	swfobject.embedSWF("/site_media/swf/OFC.swf", chart_id, "100%", "100%","9.0.0","/site_media/swf/expressInstall.swf",{"data-file": "{% url draw_graph %}" + params}, {"wmode":"transparent"});
	}
	else if (cls == "table"){
	container.find("div.table").show();
	}
	else if (cls == "excel"){
	var params = container.find("form").serialize();
        var url = "{% url down_excel %}?" + params
        location.href=url;
	}
	return false;
	}
	);

	init_calendar();
	init_dimension("{{ user.id }}", "{% url change_dimension %}");
	init_multiselect('{{ json.0.query.cityname|safe }}');
        {% endblock document_ready %}
	
        {% block main_content %}
	<table id="tab" width="100%" border="0" cellpadding="3" cellspacing="0" bordercolorlight="#DDDDDD" bordercolordark="#ffffff" style="line-height:22px;">
  <tr class="top">
    <td height="22" align="left" bgcolor="#F3F3F3" class="left"><span class="dazi"><strong>KPI报表</strong></span></td>
  </tr>
  <tr class="top">
    <td align="left" bgcolor="#FFFFFF" class="left"><table width="100%" border="0" cellpadding="5" cellspacing="0">
      <tr>
        <td width="25%" height="26"><a href="help2.html" target="_blank">KPI用户数指标</a></td>
        <td width="25%"><a href="#" target="_blank">KPI查询次数指标</a></td>
        <td width="25%"><a href="#" target="_blank">KPI信息查询用户数指标</a></td>
        <td width="25%"><a href="#" target="_blank">KPI商旅用户数指标</a></td>
      </tr>
      <tr>
        <td height="26"><a href="#" target="_blank">KPI商旅业务量指标</a></td>
        <td><a href="#" target="_blank">KPI生活播报指标</a></td>
        <td><a href="#" target="_blank">KPI前向业务指标</a></td>
        <td><a href="#" target="_blank">KPI语音后向销售指标</a></td>
      </tr>
    </table></td>
    </tr>
</table>

<table id="tab" width="100%" border="0" cellpadding="3" cellspacing="0" bordercolorlight="#DDDDDD" bordercolordark="#ffffff" style="line-height:22px;">
              <tr class="top">
                <td height="22" align="left" bgcolor="#F3F3F3" class="left"><span class="dazi"><strong>生活播报报表</strong></span></td>
              </tr>
              <tr class="top">
                <td align="left" bgcolor="#FFFFFF" class="left"><table width="100%" border="0" cellpadding="5" cellspacing="0">
                  <tr>
                    <td width="25%" height="26"><a href="#" target="_blank">生活播报存留用户报表</a><a href="kpi.html" target="_parent"></a></td>
                    <td width="25%"><a href="#" target="_blank">生活播报订购报表</a><a href="kpi_2.html" target="_parent"></a></td>
                    <td width="25%"><a href="#" target="_blank">生活播报下发量报表</a><a href="kpi_3.html" target="_parent"></a></td>
                    <td width="25%"><a href="kpi_4.html" target="_parent"></a></td>
                  </tr>
                </table></td>
              </tr>
            </table>
            <table id="tab" width="100%" border="0" cellpadding="3" cellspacing="0" bordercolorlight="#DDDDDD" bordercolordark="#ffffff" style="line-height:22px;">
              <tr class="top">
                <td height="22" align="left" bgcolor="#F3F3F3" class="left"><span class="dazi"><strong>搜索报表</strong></span></td>
              </tr>
              <tr class="top">
                <td align="left" bgcolor="#FFFFFF" class="left"><table width="100%" border="0" cellpadding="5" cellspacing="0">
                  <tr>
                    <td width="25%" height="26"><a href="#" target="_blank">产品报表</a></td>
                    <td width="25%"><a href="#" target="_blank">短信下发报表</a></td>
                    <td width="25%"><a href="#" target="_blank">话务员省报表</a></td>
                    <td width="25%"><a href="#" target="_parent">接入地报表</a><a href="kpi_4.html" target="_parent"></a></td>
                  </tr>
                </table></td>
              </tr>
            </table>

<table id="tab" width="100%" border="0" cellpadding="3" cellspacing="0" bordercolorlight="#DDDDDD" bordercolordark="#ffffff" style="line-height:22px;">
              <tr class="top">
                <td height="22" align="left" bgcolor="#F3F3F3" class="left"><span class="dazi"><strong>其他报表</strong></span></td>
              </tr>
              <tr class="top">
                <td align="left" bgcolor="#FFFFFF" class="left"><table width="100%" border="0" cellpadding="5" cellspacing="0">
                    <tr>
                      <td width="25%" height="26"><a href="#" target="_blank">产品报表</a></td>
                      <td width="25%"><a href="#" target="_blank">短信下发报表</a></td>
                      <td width="25%"><a href="#" target="_blank">话务员省报表</a></td>
                      <td width="25%"><a href="#" target="_parent">接入地报表</a><a href="kpi_4.html" target="_parent"></a></td>
                    </tr>
                </table></td>
              </tr>
            </table>
            <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br />
          <br /></td>
      </tr>
      <tr>
        <td width="8" id="yj_left5"></td>
        <td class="line_bottom" height="8">&nbsp;</td>
      </tr>
    </table></td>
  </tr>
</table>
         {% endblock main_content %}
